[{"url": "https://api.github.com/repos/rust-lang/cargo/pulls/comments/213077061", "pull_request_review_id": 149837279, "id": 213077061, "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDIxMzA3NzA2MQ==", "diff_hunk": "@@ -19,29 +19,49 @@ pub fn cli() -> App {\n }\n \n pub fn exec(config: &mut Config, args: &ArgMatches) -> CliResult {\n+    // 1. Get the registry src for this command\n     let registry = args.registry(config)?;\n+    let src_id = match &registry {\n+        Some(registry)  => SourceId::alt_registry(config, registry),\n+        None            => SourceId::crates_io(config),\n+    }?;\n+    let mut src = RegistrySource::remote(&src_id, config);\n \n+    // 2. Update the src so that we have the latest information\n+    src.update()?;\n+\n+    // 3. Check if this registry supports cargo login v1\n+    let reg_cfg = src.config()?.unwrap();\n+    if !reg_cfg.commands.get(\"login\").unwrap_or(&vec![]).iter().any(|v| v == \"v1\") {\n+        let registry = match &registry {\n+            Some(registry)  => registry,\n+            None            => \"crates-io\",\n+        };\n+        Err(format_err!(\"`{}` does not support the `cargo login` command with \\", "path": "src/bin/cargo/commands/login.rs", "position": 22, "original_position": 22, "commit_id": "8dfdc197f8f92a3c97537beae42c58caaa778123", "original_commit_id": "8dfdc197f8f92a3c97537beae42c58caaa778123", "user": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars0.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "body": "We should only check this if the token wasn't provided up front right?", "created_at": "2018-08-27T18:52:39Z", "updated_at": "2018-08-27T18:52:39Z", "html_url": "https://github.com/rust-lang/cargo/pull/5915#discussion_r213077061", "pull_request_url": "https://api.github.com/repos/rust-lang/cargo/pulls/5915", "author_association": "MEMBER", "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/cargo/pulls/comments/213077061"}, "html": {"href": "https://github.com/rust-lang/cargo/pull/5915#discussion_r213077061"}, "pull_request": {"href": "https://api.github.com/repos/rust-lang/cargo/pulls/5915"}}}]