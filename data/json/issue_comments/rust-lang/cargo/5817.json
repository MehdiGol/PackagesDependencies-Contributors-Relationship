[{"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/408568221", "html_url": "https://github.com/rust-lang/cargo/issues/5817#issuecomment-408568221", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5817", "id": 408568221, "node_id": "MDEyOklzc3VlQ29tbWVudDQwODU2ODIyMQ==", "user": {"login": "Eh2406", "id": 3709504, "node_id": "MDQ6VXNlcjM3MDk1MDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/3709504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Eh2406", "html_url": "https://github.com/Eh2406", "followers_url": "https://api.github.com/users/Eh2406/followers", "following_url": "https://api.github.com/users/Eh2406/following{/other_user}", "gists_url": "https://api.github.com/users/Eh2406/gists{/gist_id}", "starred_url": "https://api.github.com/users/Eh2406/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Eh2406/subscriptions", "organizations_url": "https://api.github.com/users/Eh2406/orgs", "repos_url": "https://api.github.com/users/Eh2406/repos", "events_url": "https://api.github.com/users/Eh2406/events{/privacy}", "received_events_url": "https://api.github.com/users/Eh2406/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-28T00:20:30Z", "updated_at": "2018-07-28T00:20:30Z", "author_association": "CONTRIBUTOR", "body": "Thanks for the cc, I am happy to help. The next step IMO is to run the problematic invocation in a profiler perf/wpr and see where we are spending the time. I can't promise when I can get to reproducing hear."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/408575754", "html_url": "https://github.com/rust-lang/cargo/issues/5817#issuecomment-408575754", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5817", "id": 408575754, "node_id": "MDEyOklzc3VlQ29tbWVudDQwODU3NTc1NA==", "user": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars0.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-28T02:10:21Z", "updated_at": "2018-07-28T02:10:21Z", "author_association": "CONTRIBUTOR", "body": "I took a quick look.  It looks like there is a massive slowdown starting in 1.27.  I don't think it is graph resolution, which is not significantly different.  Things like `build_unit_dependencies` have had a huge increase in time (going from almost 0% to ~15% of the total time before first `Compiling`).  I would guess it's the introduction of `Profile` to `Unit`, which I worried was a little heavy.  I can continue digging around to get a better picture."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/408628625", "html_url": "https://github.com/rust-lang/cargo/issues/5817#issuecomment-408628625", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5817", "id": 408628625, "node_id": "MDEyOklzc3VlQ29tbWVudDQwODYyODYyNQ==", "user": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars0.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-28T19:03:33Z", "updated_at": "2018-07-28T19:03:33Z", "author_association": "CONTRIBUTOR", "body": "I did some rough measurements of time-to-first-compile.\r\n\r\nVersion | Time\r\n------- | ----\r\n1.21 | 5.97s +/- 0.769 (!!!)\r\n1.22 | 0.48s +/- 0.023\r\n1.23 | 0.49s +/- 0.024\r\n1.24 | 0.47s +/- 0.036\r\n1.25 | 0.49s +/- 0.026\r\n1.26 | 0.50s +/- 0.024\r\nJust before Profiles(3b14988d423b1858252ee05c5395abd035bbea5f) | 0.54s +/- 0.080\r\nProfiles (c24a09772c2c1cb315970dbc721f2a42d4515f21) | 0.60s +/- 0.025\r\n1.27-stable | 0.62s +/- 0.022\r\n1.28-beta | 0.65s +/- 0.059\r\n1.29-nightly | 0.63s +/- 0.059\r\nmaster | 0.63s +/- 0.026\r\nmaster no profiles | 0.62s +/- 0.035\r\n\r\nThe last one is a hacked version where I replaced Profile in `Unit` with `&'static Profile` and used a global profile and removed profile computation.  I was surprised it didn't improve performance much.  The patch is kinda big, so maybe it is due to some other reason.\r\n\r\nThere is a lot of variability due to caching.  These numbers are after running once.  The first run can be up to 2s before it starts.  It's hard to nail down due to the variability.\r\n\r\nIt might be interesting to do more detailed profiling.  About 0.15s of the startup time is updating git submodules.  Resolve is about 0.15 to 0.2. \r\n\r\nNot sure if this is helpful at all..."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/408633298", "html_url": "https://github.com/rust-lang/cargo/issues/5817#issuecomment-408633298", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5817", "id": 408633298, "node_id": "MDEyOklzc3VlQ29tbWVudDQwODYzMzI5OA==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-28T20:34:18Z", "updated_at": "2018-07-28T20:34:18Z", "author_association": "MEMBER", "body": "Thanks for digging in @ehuss! My profile attempts on OSX didn't show the profile bits as being too much time, but I primarily saw:\r\n\r\n<img width=\"1396\" alt=\"screen shot 2018-07-28 at 1 33 07 pm\" src=\"https://user-images.githubusercontent.com/64996/43360481-ca95b742-926a-11e8-811a-ea07bd9ceed3.png\">\r\n\r\nI think the largest time here is basically spent in loading crates from the registry, which isn't uncommon for crates I've seen depending on lots of crates from crates.io\r\n\r\nIn that sense resolution itself may not be taking much time here, but rather things like reading the registry and parsing/walking git repositories (lots of git deps in this lock file)"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/408636601", "html_url": "https://github.com/rust-lang/cargo/issues/5817#issuecomment-408636601", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5817", "id": 408636601, "node_id": "MDEyOklzc3VlQ29tbWVudDQwODYzNjYwMQ==", "user": {"login": "Eh2406", "id": 3709504, "node_id": "MDQ6VXNlcjM3MDk1MDQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/3709504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Eh2406", "html_url": "https://github.com/Eh2406", "followers_url": "https://api.github.com/users/Eh2406/followers", "following_url": "https://api.github.com/users/Eh2406/following{/other_user}", "gists_url": "https://api.github.com/users/Eh2406/gists{/gist_id}", "starred_url": "https://api.github.com/users/Eh2406/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Eh2406/subscriptions", "organizations_url": "https://api.github.com/users/Eh2406/orgs", "repos_url": "https://api.github.com/users/Eh2406/repos", "events_url": "https://api.github.com/users/Eh2406/events{/privacy}", "received_events_url": "https://api.github.com/users/Eh2406/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-28T21:43:48Z", "updated_at": "2018-07-28T21:43:48Z", "author_association": "CONTRIBUTOR", "body": "Note that going from ~.50s -> ~0.6s is consistent with spending ~15% in `build_unit_dependencies`. And consistent with finding that we are spending most of our time in parsing the registry.\r\n\r\nNot that I know how to make it faster."}]