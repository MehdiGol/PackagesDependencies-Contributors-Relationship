[{"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/406806225", "html_url": "https://github.com/rust-lang/cargo/issues/5754#issuecomment-406806225", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5754", "id": 406806225, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjgwNjIyNQ==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-21T16:02:44Z", "updated_at": "2018-07-21T16:02:44Z", "author_association": "MEMBER", "body": "Thanks for this report and #5755 @luser, this is definitely not something that was expected to come up! Out of curiosity, when you compile in Gecko are you doing `cargo build --target $host` or are you just doing `cargo build`? I wrote up recently [some comments](https://github.com/rust-lang/cargo/issues/5730#issuecomment-405629218) about how those \"naively equivalent\" invocations are actually subtly different in Cargo today.\r\n\r\nThat is, I think we could pretty easily do something like this for `cargo build --target $host` as Cargo [already understands](https://github.com/rust-lang/cargo/blob/4a8495ca299fe6344d46788b858bab723cbf2831/src/cargo/core/compiler/mod.rs#L44-L51) if a compilation is for the host (build scripts, proc macros, etc) or the target. It'd be quite easy to [add an env var](https://github.com/rust-lang/cargo/blob/master/src/cargo/core/compiler/custom_build.rs#L150-L173) like `CARGO_KIND=host` or `CARGO_KIND=target` (or something like that).\r\n\r\nIf, however `cargo build` is used (without `--target`) then this situation gets a bit more tricky...\r\n\r\nIn any case, if Cargo supports this environment variable I think it'd be totally reasonable for `cc` to *not* use environment variables if `CARGO_KIND=host` and `HOST == TARGET`. Or rather, in those cases it'd perhaps have a whole different suite of env vars if really necessary it'd read from for the host."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/406806352", "html_url": "https://github.com/rust-lang/cargo/issues/5754#issuecomment-406806352", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5754", "id": 406806352, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjgwNjM1Mg==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-21T16:04:32Z", "updated_at": "2018-07-21T16:04:32Z", "author_association": "MEMBER", "body": "Oh actually I guess most of that comment would be more appropriate on https://github.com/rust-lang/cargo/issues/5755 rather than here! (I think I'm getting the two mixed up).\r\n\r\nFor Cargo's configuration do you use `[target.$target]` today for linker/rustflags/etc? Which parts are needed to configure for the host compilation (but not target)? "}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/407103847", "html_url": "https://github.com/rust-lang/cargo/issues/5754#issuecomment-407103847", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/5754", "id": 407103847, "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzEwMzg0Nw==", "user": {"login": "luser", "id": 286001, "node_id": "MDQ6VXNlcjI4NjAwMQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/286001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luser", "html_url": "https://github.com/luser", "followers_url": "https://api.github.com/users/luser/followers", "following_url": "https://api.github.com/users/luser/following{/other_user}", "gists_url": "https://api.github.com/users/luser/gists{/gist_id}", "starred_url": "https://api.github.com/users/luser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luser/subscriptions", "organizations_url": "https://api.github.com/users/luser/orgs", "repos_url": "https://api.github.com/users/luser/repos", "events_url": "https://api.github.com/users/luser/events{/privacy}", "received_events_url": "https://api.github.com/users/luser/received_events", "type": "User", "site_admin": false}, "created_at": "2018-07-23T15:43:39Z", "updated_at": "2018-07-23T15:43:39Z", "author_association": "CONTRIBUTOR", "body": "We [always pass `--target` ](https://dxr.mozilla.org/mozilla-central/rev/085cdfb90903d4985f0de1dc7786522d9fb45596/config/rules.mk#808) to cargo in the Firefox build. For things like the linker, [we currently pass them all as environment variables](https://dxr.mozilla.org/mozilla-central/rev/085cdfb90903d4985f0de1dc7786522d9fb45596/config/rules.mk#918) when invoking cargo. We do have [a few things in .cargo/config](https://dxr.mozilla.org/mozilla-central/rev/085cdfb90903d4985f0de1dc7786522d9fb45596/.cargo/config.in), including a path to a batch file to use as a linker when we're building a win32 build with a win64 rustc (which is similar to what this issue is about, but simpler because the target and host are not the same)."}]