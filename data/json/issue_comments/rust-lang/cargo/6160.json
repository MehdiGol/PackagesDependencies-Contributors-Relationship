[{"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/428533007", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-428533007", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 428533007, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODUzMzAwNw==", "user": {"login": "bltavares", "id": 109474, "node_id": "MDQ6VXNlcjEwOTQ3NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/109474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bltavares", "html_url": "https://github.com/bltavares", "followers_url": "https://api.github.com/users/bltavares/followers", "following_url": "https://api.github.com/users/bltavares/following{/other_user}", "gists_url": "https://api.github.com/users/bltavares/gists{/gist_id}", "starred_url": "https://api.github.com/users/bltavares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bltavares/subscriptions", "organizations_url": "https://api.github.com/users/bltavares/orgs", "repos_url": "https://api.github.com/users/bltavares/repos", "events_url": "https://api.github.com/users/bltavares/events{/privacy}", "received_events_url": "https://api.github.com/users/bltavares/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-10T11:12:04Z", "updated_at": "2018-10-10T11:12:04Z", "author_association": "NONE", "body": "This seems to come from this line: https://github.com/rust-lang/cargo/blob/ce455cd2aa3d11bab3818b8fdee87a11ffceb79b/src/cargo/core/compiler/build_context/target_info.rs#L85-L90\r\n\r\nAm I heading to the right direction?"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/428690038", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-428690038", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 428690038, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODY5MDAzOA==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-10T18:54:47Z", "updated_at": "2018-10-10T18:54:47Z", "author_association": "MEMBER", "body": "Thanks for the report! Unfortunately though `--crate-type` will not work in RUSTFLAGS, because it affects output artifacts Cargo needs to know about it ahead of time, not through `RUSTFLAGS`.\r\n\r\nWe could improve the error message here though for sure!"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/428734072", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-428734072", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 428734072, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODczNDA3Mg==", "user": {"login": "bltavares", "id": 109474, "node_id": "MDQ6VXNlcjEwOTQ3NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/109474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bltavares", "html_url": "https://github.com/bltavares", "followers_url": "https://api.github.com/users/bltavares/followers", "following_url": "https://api.github.com/users/bltavares/following{/other_user}", "gists_url": "https://api.github.com/users/bltavares/gists{/gist_id}", "starred_url": "https://api.github.com/users/bltavares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bltavares/subscriptions", "organizations_url": "https://api.github.com/users/bltavares/orgs", "repos_url": "https://api.github.com/users/bltavares/repos", "events_url": "https://api.github.com/users/bltavares/events{/privacy}", "received_events_url": "https://api.github.com/users/bltavares/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-10T21:13:33Z", "updated_at": "2018-10-10T21:13:33Z", "author_association": "NONE", "body": "@alexcrichton thanks for replying.\r\n\r\nIn regard of the expected behavior for the flags. Should a lib that have not defined a crate-type produce both the `rlib` and `staticlib` if I call `cargo rustc --release -- --crate-type staticlib`?\r\n\r\nNowaday, both type of creates are produced. I would expect that the flags override whatever is defined on `Cargo.toml`, not combined.\r\n\r\nThis also means that it is also not possible to pass `cargo rustc --release -- --crate-type staticlib -C lto`, as if there is a rlib on the build plan the feature gets disable.\r\n\r\nWhat is the expected behavior of the CLI flag?"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/428778868", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-428778868", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 428778868, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODc3ODg2OA==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-11T00:41:11Z", "updated_at": "2018-10-11T00:41:11Z", "author_association": "MEMBER", "body": "@bltavares it's unfortunately basically not expected for manual specification of `--crate-type` to work at all. Cargo treats rustflags as a black box, and `--crate-type` is one of those flags which can just cause compilation to go awry in a whole manner of ways."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/428961728", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-428961728", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 428961728, "node_id": "MDEyOklzc3VlQ29tbWVudDQyODk2MTcyOA==", "user": {"login": "bltavares", "id": 109474, "node_id": "MDQ6VXNlcjEwOTQ3NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/109474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bltavares", "html_url": "https://github.com/bltavares", "followers_url": "https://api.github.com/users/bltavares/followers", "following_url": "https://api.github.com/users/bltavares/following{/other_user}", "gists_url": "https://api.github.com/users/bltavares/gists{/gist_id}", "starred_url": "https://api.github.com/users/bltavares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bltavares/subscriptions", "organizations_url": "https://api.github.com/users/bltavares/orgs", "repos_url": "https://api.github.com/users/bltavares/repos", "events_url": "https://api.github.com/users/bltavares/events{/privacy}", "received_events_url": "https://api.github.com/users/bltavares/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-11T13:47:16Z", "updated_at": "2018-10-11T13:47:16Z", "author_association": "NONE", "body": "I think it was a mismatch of expectations more than the error message.\r\n\r\nFrom [Rust Docs](https://doc.rust-lang.org/reference/linkage.html):\r\n>  If one or more command line flags are specified, all crate_type attributes will be ignored in favor of only building the artifacts specified by command line.\r\n\r\nThis looks to be applied to `rustc` only (if I understood it correctly), while I had the expectation to also be applied to `cargo rustc`.\r\n\r\nShould I focus on a workaround editing the `Cargo.toml` to change the `crate-type` attribute on those build phases instead of making `--crate-type` a flag which cargo knows about?"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/429092864", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-429092864", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 429092864, "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTA5Mjg2NA==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-11T19:44:29Z", "updated_at": "2018-10-11T19:44:29Z", "author_association": "MEMBER", "body": "Unfortunately there's not really a great way forward for something like this, but if editing `Cargo.toml` works for now that's probably \"best\", although it's by no measure a great solution"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/429137798", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-429137798", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 429137798, "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTEzNzc5OA==", "user": {"login": "bltavares", "id": 109474, "node_id": "MDQ6VXNlcjEwOTQ3NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/109474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bltavares", "html_url": "https://github.com/bltavares", "followers_url": "https://api.github.com/users/bltavares/followers", "following_url": "https://api.github.com/users/bltavares/following{/other_user}", "gists_url": "https://api.github.com/users/bltavares/gists{/gist_id}", "starred_url": "https://api.github.com/users/bltavares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bltavares/subscriptions", "organizations_url": "https://api.github.com/users/bltavares/orgs", "repos_url": "https://api.github.com/users/bltavares/repos", "events_url": "https://api.github.com/users/bltavares/events{/privacy}", "received_events_url": "https://api.github.com/users/bltavares/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-11T22:16:20Z", "updated_at": "2018-10-11T22:16:20Z", "author_association": "NONE", "body": "Given how hard this would be, I would be ok to close this issue, even tho the error message is confusing.\r\n\r\nWould it be ok if I open a PR on Cargo with a note on the docs regarding this behavior?"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/429398815", "html_url": "https://github.com/rust-lang/cargo/issues/6160#issuecomment-429398815", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6160", "id": 429398815, "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTM5ODgxNQ==", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars1.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-12T17:21:24Z", "updated_at": "2018-10-12T17:21:24Z", "author_association": "MEMBER", "body": "Ok sounds good to me! And certainly yeah, PRs improving docs are always appreciated!"}]