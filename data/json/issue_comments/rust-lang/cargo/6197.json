[{"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/431641707", "html_url": "https://github.com/rust-lang/cargo/issues/6197#issuecomment-431641707", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6197", "id": 431641707, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTY0MTcwNw==", "user": {"login": "ishitatsuyuki", "id": 12389383, "node_id": "MDQ6VXNlcjEyMzg5Mzgz", "avatar_url": "https://avatars2.githubusercontent.com/u/12389383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ishitatsuyuki", "html_url": "https://github.com/ishitatsuyuki", "followers_url": "https://api.github.com/users/ishitatsuyuki/followers", "following_url": "https://api.github.com/users/ishitatsuyuki/following{/other_user}", "gists_url": "https://api.github.com/users/ishitatsuyuki/gists{/gist_id}", "starred_url": "https://api.github.com/users/ishitatsuyuki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ishitatsuyuki/subscriptions", "organizations_url": "https://api.github.com/users/ishitatsuyuki/orgs", "repos_url": "https://api.github.com/users/ishitatsuyuki/repos", "events_url": "https://api.github.com/users/ishitatsuyuki/events{/privacy}", "received_events_url": "https://api.github.com/users/ishitatsuyuki/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-21T06:07:16Z", "updated_at": "2018-10-21T06:07:16Z", "author_association": "MEMBER", "body": "I disagree. We don't have buffering yet, and yes if buffering is implemented your solution address a part of the problem.\r\n\r\nThe problem is simply that we don't have backpressure for consuming logs as we use an unbounded `channel`. `yes` is simply producing output too fast than we can forward. As a result, this is unlikely to actually blow things up in reality.\r\n\r\nFix: make this bounded.\r\n\r\nhttps://github.com/rust-lang/cargo/blob/2d0863f657e6f45159fc7412267eee3e659185e5/src/cargo/core/compiler/job_queue.rs#L135"}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/431644342", "html_url": "https://github.com/rust-lang/cargo/issues/6197#issuecomment-431644342", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6197", "id": 431644342, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTY0NDM0Mg==", "user": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-21T07:02:21Z", "updated_at": "2018-10-21T07:02:21Z", "author_association": "NONE", "body": "@ishitatsuyuki: This did come up for real - setting `RUST_LOG=debug` when compiling a large crate causes it for me. The `yes` example was just a convenient way to reliably reproduce it."}, {"url": "https://api.github.com/repos/rust-lang/cargo/issues/comments/431878029", "html_url": "https://github.com/rust-lang/cargo/issues/6197#issuecomment-431878029", "issue_url": "https://api.github.com/repos/rust-lang/cargo/issues/6197", "id": 431878029, "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTg3ODAyOQ==", "user": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars0.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "created_at": "2018-10-22T15:58:18Z", "updated_at": "2018-10-22T15:58:18Z", "author_association": "CONTRIBUTOR", "body": "I think there are multiple issues here.\r\n\r\nSimple commands like `rustc -Vv` use [`command.output()`](https://github.com/rust-lang/cargo/blob/2d0863f657e6f45159fc7412267eee3e659185e5/src/cargo/util/process_builder.rs#L176) which buffers the entire output.  `exec_with_output` is used in a few places to call `rustc` to gather information. The `yes` example hits these situations, so it may be a little artificial since these usually should emit only a small amount of output even with debugging.\r\n\r\nDuring the normal compile execution, even though the output is streamed to the terminal, internally it buffers the entire result [here](https://github.com/rust-lang/cargo/blob/2d0863f657e6f45159fc7412267eee3e659185e5/src/cargo/util/process_builder.rs#L232). This is used in a few cases (like capturing build script output), but for the case of running `rustc` I don't believe it is necessary.\r\n"}]